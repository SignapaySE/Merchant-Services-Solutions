<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <!-- Mobile viewport tuned for iOS Safari -->
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Merchant Solutions Finder</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    html, body { height: 100%; }
    /* Reduce tap delay & avoid accidental double-tap zoom on buttons/links */
    button, a { touch-action: manipulation; }
    /* When modal is open, prevent background scroll */
    .scroll-lock { overflow: hidden; height: 100%; }
    /* iOS momentum scrolling inside modal content */
    .modal-scroll { -webkit-overflow-scrolling: touch; }
  </style>
</head>
<body class="min-h-screen bg-slate-900 font-sans text-slate-100">
  <div class="mx-auto max-w-5xl p-4 pb-[env(safe-area-inset-bottom)]">
    <!-- Header -->
    <header class="mb-6 rounded-3xl bg-gradient-to-r from-blue-700 to-blue-500 p-4 sm:p-6 text-white shadow-sm">
      <div class="flex flex-col gap-3 md:flex-row md:items-center md:justify-between">
        <div class="flex items-center gap-3 md:gap-4">
          <img src="https://static.wixstatic.com/media/e80bbd_a8148979599e4221be758a561140d67a~mv2.png"
               alt="SignaPay Southeast"
               class="h-12 w-auto object-contain sm:h-14 md:h-16"/>
          <div class="flex-1 min-w-0">
            <h1 class="truncate text-2xl font-extrabold leading-tight tracking-tight sm:text-3xl md:text-4xl">
              Merchant Solutions Finder
            </h1>
            <p class="text-xs text-blue-100 sm:text-sm">Helping you find the right fit</p>
          </div>
        </div>
        <div class="flex md:self-start">
          <button id="resetBtn" type="button"
                  class="rounded-full bg-white/10 px-3 py-1 text-xs hover:bg-white/20">
            Reset
          </button>
        </div>
      </div>
    </header>

    <!-- Stepper -->
    <nav class="mb-6 grid grid-cols-3 gap-2 text-[11px] sm:text-xs" id="stepper">
      <div class="rounded-xl border px-3 py-2">1. Business type</div>
      <div class="rounded-xl border px-3 py-2">2. Needs</div>
      <div class="rounded-xl border px-3 py-2">3. Solutions</div>
    </nav>

    <!-- Step 1 -->
    <section id="step1" class="grid grid-cols-1 gap-3 md:grid-cols-2"></section>

    <!-- Step 2 -->
    <section id="step2" class="hidden">
      <div class="mb-4 flex items-center justify-between">
        <h2 class="text-lg font-semibold text-slate-100" id="needsTitle">What does this need?</h2>
        <div class="flex gap-2">
          <button id="selectAll" type="button" class="rounded-xl border border-slate-700 bg-slate-800 px-3 py-2 text-xs hover:bg-slate-700">Select all</button>
          <button id="clearAll"  type="button" class="rounded-xl border border-slate-700 bg-slate-800 px-3 py-2 text-xs hover:bg-slate-700">Clear</button>
        </div>
      </div>
      <div id="needsGrid" class="grid grid-cols-1 gap-3 md:grid-cols-2 lg:grid-cols-3"></div>
      <div class="mt-6 flex justify-end gap-2">
        <button id="backTo1" type="button" class="rounded-xl border border-slate-700 bg-slate-800 px-4 py-2 text-sm hover:bg-slate-700">Back</button>
        <button id="toStep3" type="button" class="rounded-xl bg-blue-600 px-4 py-2 text-sm font-semibold text-white hover:bg-blue-700">See solutions</button>
      </div>
    </section>

    <!-- Step 3 -->
    <section id="step3" class="hidden">
      <div class="mb-4 flex items-center justify-between">
        <h2 class="text-lg font-semibold text-slate-100">Recommended solutions</h2>
        <button id="adjustNeeds" type="button" class="rounded-xl border border-slate-700 bg-slate-800 px-3 py-2 text-xs hover:bg-slate-700">Adjust needs</button>
      </div>
      <div id="solutionsGrid" class="grid grid-cols-1 gap-4 md:grid-cols-2"></div>
    </section>

    <!-- Modal -->
    <div id="modal" class="fixed inset-0 z-50 hidden items-end md:items-center md:justify-center" role="dialog" aria-modal="true">
      <div class="absolute inset-0 bg-slate-900/70" id="modalBackdrop" tabindex="-1"></div>
      <!-- Content: scrollable, capped height -->
      <div class="relative w-full max-w-3xl rounded-t-3xl bg-slate-900 p-6 shadow-2xl ring-1 ring-slate-700 md:rounded-3xl max-h-[85vh] overflow-y-auto modal-scroll">
        <div class="mb-4 flex items-start justify-between gap-4">
          <div>
            <h3 class="text-xl font-bold text-slate-100" id="modalTitle"></h3>
            <p class="text-sm text-slate-400">Comprehensive analysis</p>
          </div>
          <button id="modalClose" type="button" class="rounded-full bg-slate-800 px-3 py-1 text-sm text-slate-100 ring-1 ring-slate-700 hover:bg-slate-700">Close</button>
        </div>

        <div class="mb-4 flex flex-wrap gap-2" id="modalLinks"></div>

        <div class="mb-6 grid grid-cols-1 gap-4 md:grid-cols-2">
          <div class="rounded-2xl border border-green-900 bg-green-900/20 p-4">
            <h4 class="mb-2 text-sm font-semibold text-green-300">Matches your selected needs</h4>
            <ul id="modalMatches" class="list-inside list-disc text-sm text-green-200"></ul>
          </div>
          <div class="rounded-2xl border border-red-900 bg-red-900/20 p-4">
            <h4 class="mb-2 text-sm font-semibold text-red-300">Not covered</h4>
            <ul id="modalMisses" class="list-inside list-disc text-sm text-red-200"></ul>
          </div>
        </div>

        <!-- Terminal detail blocks -->
        <div id="terminalDetails" class="hidden mt-4 rounded-2xl border border-slate-700 bg-slate-800 p-4">
          <h4 class="mb-2 text-sm font-semibold text-slate-200">Available SignaPay terminal models</h4>
          <ul class="grid grid-cols-1 gap-2 md:grid-cols-2">
            <li class="rounded-lg border border-slate-700 p-3 text-sm">
              <div class="font-medium">Valor VL100 / VL100 Pro</div>
              <div class="text-xs text-slate-400">Countertop · EMV, NFC, Wi-Fi/Ethernet</div>
              <a href="https://valorpaytech.com/what-we-do/hardware-products/countertop-pos/vl100-pro/" target="_blank" rel="noreferrer" class="mt-2 inline-block text-xs font-medium text-blue-300 underline">Official page ↗</a>
            </li>
            <li class="rounded-lg border border-slate-700 p-3 text-sm">
              <div class="font-medium">Dejavoo QD4</div>
              <div class="text-xs text-slate-400">Android countertop · EMV, NFC, Ethernet/Wi-Fi</div>
              <a href="https://dejavoo.io/products/qd-terminals-family/qd4/" target="_blank" rel="noreferrer" class="mt-2 inline-block text-xs font-medium text-blue-300 underline">Official page ↗</a>
            </li>
            <li class="rounded-lg border border-slate-700 p-3 text-sm">
              <div class="font-medium">PAX A80</div>
              <div class="text-xs text-slate-400">Android countertop · EMV, NFC, Ethernet/Wi-Fi</div>
              <a href="https://www.paxtechnology.com/a80" target="_blank" rel="noreferrer" class="mt-2 inline-block text-xs font-medium text-blue-300 underline">Official page ↗</a>
            </li>
            <li class="rounded-lg border border-slate-700 p-3 text-sm">
              <div class="font-medium">Dejavoo P3 (Wireless)</div>
              <div class="text-xs text-slate-400">Handheld LTE/Wi-Fi · EMV, NFC, built-in printer</div>
              <a href="https://dejavoo.io/products/p-terminals-family/p3/" target="_blank" rel="noreferrer" class="mt-2 inline-block text-xs font-medium text-blue-300 underline">Official page ↗</a>
            </li>
          </ul>
        </div>

        <div id="shift4Details" class="hidden mt-4 rounded-2xl border border-slate-700 bg-slate-800 p-4">
          <h4 class="mb-2 text-sm font-semibold text-slate-200">Shift4 desktop terminals</h4>
          <ul class="grid grid-cols-1 gap-2 md:grid-cols-2">
            <li class="rounded-lg border border-slate-700 p-3 text-sm">
              <div class="font-medium">Countertop EMV/NFC terminals</div>
              <div class="text-xs text-slate-400">Secure EMV chip, PIN, contactless, receipt printing</div>
              <a href="https://www.shift4network.com/credit-card-terminals/" target="_blank" rel="noreferrer" class="mt-2 inline-block text-xs font-medium text-blue-300 underline">Shift4 terminals ↗</a>
            </li>
          </ul>
        </div>

        <div class="mt-4" id="allFeaturesBlock">
          <h4 class="mb-2 text-sm font-semibold text-slate-200">All features</h4>
          <div id="allFeatures" class="flex flex-wrap gap-2"></div>
        </div>
      </div>
    </div>

    <footer class="mt-10 text-center text-xs text-slate-400">
      Clover, SkyTab, SignaPay, and Shift4 data provided · Links go to official sites
    </footer>
  </div>

  <script>
    /* ===== Feature Menu ===== */
    const FEATURE_MENU = {
      Restaurant: [
        "Tips","Table Service","Counter Service","Reservations","Online Ordering",
        "QR Code Ordering","Kitchen Printer Integration","Inventory Management",
        "Loyalty Programs","Gift Cards","Customer Display","Employee Management",
        "Labor Management","Reporting & Analytics","Mobile Payments","Pay-at-Table",
        "Website Builder","App Marketplace","Payroll Integration","EMV Chip & PIN",
        "Contactless Payments","Wi-Fi / Wireless","Receipt Printing","PCI Compliance",
        "Terminal Simplicity"
      ],
      Retail: [
        "Inventory","Barcode Scanning","Customer Display","Discounts","Purchase Orders",
        "Gift Cards","Loyalty","Cash Drawer","Reporting & Analytics","PIN Debit",
        "Dual Pricing","PCI Compliance"
      ],
    };

    /* ===== Catalog (Restaurant + Retail) ===== */
    const CATALOG = [
      // Restaurant
      { id:"clover", name:"Clover POS", type:"Restaurant",
        description:"Customizable all-in-one POS system with hardware options, app marketplace, and robust tools for restaurants.",
        featureTags:["Tips","Table Service","Counter Service","Reservations","Online Ordering","Inventory Management","Loyalty Programs","Gift Cards","Customer Display","Employee Management","Reporting & Analytics","Mobile Payments","Payroll Integration","App Marketplace","PCI Compliance"],
        productLink:"https://www.clover.com", paperworkLink:"https://www.zoho.com" },
      { id:"skytab", name:"SkyTab POS", type:"Restaurant",
        description:"Modern restaurant POS with built-in online ordering, reservations, QR code payments, and pay-at-the-table.",
        featureTags:["Tips","Table Service","Reservations","Online Ordering","QR Code Ordering","Kitchen Printer Integration","Inventory Management","Loyalty Programs","Gift Cards","Customer Display","Labor Management","Reporting & Analytics","Pay-at-Table","Mobile Management App","Website Builder","PCI Compliance"],
        productLink:"https://www.skytab.com", paperworkLink:"https://www.zoho.com" },
      { id:"signapay-terminals", name:"SignaPay SE Desktop Terminals", type:"Restaurant",
        description:"Countertop and wireless credit card terminals (Valor 100, Dejavoo QD4, PAX A80, Dejavoo P3) for secure restaurant payments.",
        featureTags:["Tips","Counter Service","Mobile Payments","EMV Chip & PIN","Contactless Payments","Wi-Fi / Wireless","Terminal Simplicity","Receipt Printing"],
        productLink:"https://www.signapayse.com", paperworkLink:"https://www.zoho.com" },
      { id:"shift4-terminals", name:"Shift4 Desktop Terminals", type:"Restaurant",
        description:"Countertop payment terminals from Shift4 offering secure EMV, NFC contactless, and reliable processing for restaurants.",
        featureTags:["Counter Service","EMV Chip & PIN","Contactless Payments","PCI Compliance","Receipt Printing","Terminal Simplicity"],
        productLink:"https://www.shift4network.com/credit-card-terminals/", paperworkLink:"https://www.zoho.com" },

      // Retail (SkyTab excluded)
      { id:"clover-retail", name:"Clover POS", type:"Retail",
        description:"Clover POS for retail provides inventory management, barcode scanning, loyalty, and integrated payments for stores.",
        featureTags:["Inventory","Barcode Scanning","Customer Display","Discounts","Purchase Orders","Gift Cards","Loyalty","Cash Drawer","Reporting & Analytics","PIN Debit","Dual Pricing","PCI Compliance"],
        productLink:"https://www.clover.com", paperworkLink:"https://www.zoho.com" },
      { id:"signapay-retail-terminals", name:"SignaPay SE Desktop Terminals", type:"Retail",
        description:"Secure countertop and wireless payment terminals for retail stores supporting EMV, NFC, and simple card acceptance.",
        featureTags:["Counter Service","EMV Chip & PIN","Contactless Payments","Receipt Printing","Terminal Simplicity","PIN Debit","Dual Pricing"],
        productLink:"https://www.signapayse.com", paperworkLink:"https://www.zoho.com" },
      { id:"shift4-retail-terminals", name:"Shift4 Desktop Terminals", type:"Retail",
        description:"Shift4 retail terminals provide reliable card acceptance with EMV, contactless payments, and PCI compliant processing.",
        featureTags:["Counter Service","EMV Chip & PIN","Contactless Payments","PCI Compliance","Receipt Printing","Terminal Simplicity","PIN Debit"],
        productLink:"https://www.shift4network.com/credit-card-terminals/", paperworkLink:"https://www.zoho.com" },
    ];

    const TYPES = Object.keys(FEATURE_MENU);

    /* ===== State ===== */
    let step = 1;
    let bizType = null;
    let selected = [];
    let openSolution = null;

    /* ===== DOM refs ===== */
    const stepper = document.getElementById('stepper');
    const step1 = document.getElementById('step1');
    const step2 = document.getElementById('step2');
    const step3 = document.getElementById('step3');
    const needsTitle = document.getElementById('needsTitle');
    const needsGrid = document.getElementById('needsGrid');
    const solutionsGrid = document.getElementById('solutionsGrid');
    const resetBtn = document.getElementById('resetBtn');
    const adjustNeedsBtn = document.getElementById('adjustNeeds');

    const modal = document.getElementById('modal');
    const modalBackdrop = document.getElementById('modalBackdrop');
    const modalClose = document.getElementById('modalClose');
    const modalTitle = document.getElementById('modalTitle');
    const modalLinks = document.getElementById('modalLinks');
    const modalMatches = document.getElementById('modalMatches');
    const modalMisses = document.getElementById('modalMisses');
    const allFeatures = document.getElementById('allFeatures');
    const terminalDetails = document.getElementById('terminalDetails');
    const shift4Details = document.getElementById('shift4Details');

    /* ===== Rendering ===== */
    function renderStepper() {
      [...stepper.children].forEach((el, i) => {
        const idx = i + 1;
        const active = step === idx;
        const done = step > idx;
        el.className =
          "rounded-xl border px-3 py-2 " +
          (active
            ? "border-blue-400 bg-blue-900 text-blue-100"
            : done
            ? "border-blue-300 bg-slate-800 text-blue-300"
            : "border-slate-700 bg-slate-800 text-slate-400");
      });
    }

    function makeTypeButton(label, icon) {
      const btn = document.createElement('button');
      btn.type = "button";
      btn.className =
        "group flex w-full items-center gap-3 rounded-2xl border p-4 transition border-slate-700 bg-slate-800 hover:bg-slate-700";
      btn.onclick = () => { bizType = label; step = 2; render(); };

      const iconDiv = document.createElement('div');
      iconDiv.className = "text-lg";
      iconDiv.textContent = icon;

      const left = document.createElement('div');
      left.className = "flex-1 text-left";
      left.innerHTML = `
        <div class="font-semibold text-slate-100">${label}</div>
        <div class="text-xs text-slate-400">Tap to select this business type</div>
      `;

      const bullet = document.createElement('div');
      bullet.className = "h-5 w-5 rounded-full border border-slate-600";

      btn.append(iconDiv, left, bullet);
      return btn;
    }

    function renderStep1() {
      step1.innerHTML = "";
      step1.classList.toggle('hidden', step !== 1);
      const map = { Restaurant: "🍽️", Retail: "🛍️" };
      TYPES.forEach(t => step1.appendChild(makeTypeButton(t, map[t] || "💼")));
    }

    function renderStep2() {
      step2.classList.toggle('hidden', step !== 2);
      if (step !== 2) return;
      needsTitle.textContent = `What does this ${bizType} need?`;
      needsGrid.innerHTML = "";
      const menu = FEATURE_MENU[bizType] || [];
      menu.forEach(m => {
        const label = document.createElement('label');
        label.className = "flex cursor-pointer items-center gap-3 rounded-xl border border-slate-700 bg-slate-800 p-3 hover:bg-slate-700";

        const input = document.createElement('input');
        input.type = "checkbox";
        input.className = "h-4 w-4";
        input.checked = selected.includes(m);
        input.onchange = () => {
          if (selected.includes(m)) selected = selected.filter(x => x !== m);
          else selected.push(m);
        };

        const span = document.createElement('span');
        span.className = "text-sm text-slate-100";
        span.textContent = m;

        label.append(input, span);
        needsGrid.appendChild(label);
      });

      document.getElementById('selectAll').onclick = () => { selected = [...menu]; renderStep2(); };
      document.getElementById('clearAll').onclick = () => { selected = []; renderStep2(); };
      document.getElementById('backTo1').onclick = () => { step = 1; render(); };
      document.getElementById('toStep3').onclick  = () => { step = 3; render(); };
    }

    function scoreSolution(item) {
      if (selected.length === 0) return 100;
      const overlap = item.featureTags.filter(t => selected.includes(t)).length;
      return Math.round((overlap / Math.max(selected.length, 1)) * 100);
    }

    function makeSolutionCard(item, score) {
      const btn = document.createElement('button');
      btn.type = "button";
      btn.className = "text-left w-full";
      btn.onclick = () => openAnalysis(item);

      const card = document.createElement('div');
      card.className = "rounded-2xl border border-blue-500/40 bg-slate-800 p-4 shadow-sm transition hover:shadow-md";

      const top = document.createElement('div');
      top.className = "mb-1 flex items-start justify-between gap-3";

      const title = document.createElement('h3');
      title.className = "text-base font-semibold text-slate-100";
      title.textContent = item.name;

      const badge = document.createElement('span');
      badge.className = "inline-flex items-center rounded-full border border-blue-400 bg-blue-900/40 px-2 py-0.5 text-xs font-medium text-blue-200";
      badge.textContent = item.type;

      top.append(title, badge);

      const desc = document.createElement('p');
      desc.className = "mb-3 text-sm text-slate-300";
      desc.textContent = item.description;

      const ms = document.createElement('div');
      const scoreColor = score > 0 ? "text-green-400" : "text-red-400";
      ms.className = "mb-3 text-xs text-slate-300";
      ms.innerHTML = `Match score: <span class="font-semibold ${scoreColor}">${score}%</span>`;

      card.append(top, desc, ms);
      btn.appendChild(card);
      return btn;
    }

    function renderStep3() {
      step3.classList.toggle('hidden', step !== 3);
      if (step !== 3) return;
      solutionsGrid.innerHTML = "";
      const pool = CATALOG.filter(c => c.type === bizType);
      const scored = pool.map(item => ({ item, score: scoreSolution(item) }))
                         .sort((a,b) => b.score - a.score);
      if (scored.length === 0) {
        const empty = document.createElement('div');
        empty.className = "rounded-xl border border-slate-700 bg-slate-800 p-6 text-sm text-slate-300";
        empty.textContent = "No matches yet. Try adding or removing needs.";
        solutionsGrid.appendChild(empty);
      } else {
        scored.forEach(({item, score}) => solutionsGrid.appendChild(makeSolutionCard(item, score)));
      }
      adjustNeedsBtn.onclick = () => { step = 2; render(); };
    }

    /* ===== Modal control (iOS-safe) ===== */
    function openAnalysis(item) {
      openSolution = item;

      modalTitle.textContent = item.name;
      modalLinks.innerHTML = "";
      if (item.productLink) {
        const a = document.createElement('a');
        a.href = item.productLink; a.target = "_blank"; a.rel = "noreferrer";
        a.className = "rounded-lg bg-blue-600 px-3 py-2 text-xs font-medium text-white hover:bg-blue-700";
        a.textContent = "Official product page ↗";
        modalLinks.appendChild(a);
      }
      if (item.paperworkLink) {
        const a2 = document.createElement('a');
        a2.href = item.paperworkLink; a2.target = "_blank"; a2.rel = "noreferrer";
        a2.className = "rounded-lg bg-blue-900/30 px-3 py-2 text-xs font-medium text-blue-200 ring-1 ring-blue-800 hover:bg-blue-900/50";
        a2.textContent = "Paperwork ↗";
        modalLinks.appendChild(a2);
      }

      const matches = selected.filter(f => item.featureTags?.includes(f));
      const misses  = selected.filter(f => !item.featureTags?.includes(f));
      modalMatches.innerHTML = matches.length ? matches.map(f => `<li>${f}</li>`).join("") : "<li>No direct matches selected.</li>";
      modalMisses.innerHTML = selected.length ? misses.map(f => `<li>${f}</li>`).join("") : "<li>No needs selected.</li>";

      allFeatures.innerHTML = (item.featureTags || []).map(f =>
        `<span class="rounded-full border border-slate-700 bg-slate-800 px-2 py-0.5 text-xs text-slate-200">${f}</span>`
      ).join("");

      terminalDetails.classList.add('hidden');
      shift4Details.classList.add('hidden');
      if (item.id === "signapay-terminals" || item.id === "signapay-retail-terminals") terminalDetails.classList.remove('hidden');
      if (item.id === "shift4-terminals"   || item.id === "shift4-retail-terminals")   shift4Details.classList.remove('hidden');

      modal.classList.remove('hidden'); modal.classList.add('flex');
      // Lock page scroll (iOS friendly)
      document.documentElement.classList.add('scroll-lock');
      document.body.classList.add('scroll-lock');
    }

    function closeModal() {
      modal.classList.add('hidden'); modal.classList.remove('flex');
      openSolution = null;
      document.documentElement.classList.remove('scroll-lock');
      document.body.classList.remove('scroll-lock');
    }

    /* ===== Wire events ===== */
    document.getElementById('modalBackdrop').addEventListener('click', closeModal);
    document.getElementById('modalClose').addEventListener('click', closeModal);
    resetBtn.addEventListener('click', () => { step = 1; bizType = null; selected = []; render(); });

    /* ===== Initial render ===== */
    function render() { renderStepper(); renderStep1(); renderStep2(); renderStep3(); }
    render();
  </script>
</body>
</html>
