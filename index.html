<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />

  <!-- Force browsers to always revalidate HTML -->
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate" />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="0" />

  <!-- Mobile viewport -->
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Merchant Services Solutions</title>

  <!-- Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>

  <!-- Base tweaks + stepper styles -->
  <style>
    html, body { height: 100%; }
    button, a { touch-action: manipulation; }
    .scroll-lock { overflow: hidden; height: 100%; }
    .modal-scroll { -webkit-overflow-scrolling: touch; }

    #stepper { display: flex; gap: 0; }
    #stepper > * { margin: 0; border-radius: 0; position: relative; }
    #stepper > :first-child { border-top-left-radius: .75rem; border-bottom-left-radius: .75rem; }
    #stepper > :last-child  { border-top-right-radius: .75rem; border-bottom-right-radius: .75rem; }

    .step-chev { position: relative; padding-right: 2.25rem; flex: 1 1 0; text-align: center; }
    .step-chev::after {
      content: ""; position: absolute; top: 0; right: -1rem; width: 1.25rem; height: 100%;
      background: inherit; transform: skewX(30deg);
      border-right: 1px solid rgba(148,163,184,.35);
      border-top:   1px solid rgba(148,163,184,.35);
      border-bottom:1px solid rgba(148,163,184,.35);
      border-left: none; border-radius: 0 .5rem .5rem 0; z-index: 1; pointer-events: none;
    }
    .step-chev.last::after { display: none; }
    .step-chev.inactive { background: transparent; }
    .step-chev.active   { background: rgba(30,41,59,.6); }
  </style>
</head>

<body class="min-h-screen bg-slate-900 font-sans text-slate-100">
  <div class="mx-auto max-w-5xl p-4 pb-[env(safe-area-inset-bottom)]">

    <!-- Header -->
    <header class="relative mb-6 rounded-3xl bg-gradient-to-r from-blue-700 to-blue-500 p-4 sm:p-6 text-white shadow-sm pr-32 md:pr-44">
      <div class="flex flex-col gap-3 md:flex-row md:items-center md:justify-between">
        <div class="flex-1 min-w-0">
          <h1 class="text-3xl md:text-4xl font-extrabold tracking-tight">Merchant Services Solutions</h1>
          <p class="text-sm md:text-base text-slate-200/80">Find the perfect product</p>
        </div>
      </div>

      <!-- Logo -->
      <img
        src="https://static.wixstatic.com/media/e80bbd_a8148979599e4221be758a561140d67a~mv2.png"
        alt="SignaPay Southeast"
        class="absolute bottom-2 right-3 h-12 w-auto sm:h-14 md:h-16 opacity-90 hover:opacity-100 transition pointer-events-none z-0" />
    </header>

    <!-- Controls row -->
    <div class="mb-4 flex items-center justify-between gap-3">
      <nav id="stepper" class="mb-6 flex gap-0 flex-1 text-[11px] sm:text-xs">
        <div class="step-chev active  border px-3 py-2">1. Business type</div>
        <div class="step-chev inactive border px-3 py-2">2. Needs</div>
        <div class="step-chev last inactive border px-3 py-2">3. Solutions</div>
      </nav>

      <button id="resetBtn" type="button"
              class="rounded-full bg-white/10 px-3 py-1 text-xs
                     border border-slate-400/40 shadow-sm text-slate-100
                     hover:bg-slate-700/40 hover:brightness-110 transition">
        Reset
      </button>
    </div>

    <!-- Prompt -->
    <p id="categoryPrompt" class="mt-3 mb-2 text-sm text-slate-300 flex items-center justify-center gap-2">
      <span class="inline-block h-1.5 w-1.5 rounded-full bg-sky-300/80"></span>
      <span id="promptText">What type of business are you working with today?</span>
    </p>

    <!-- Steps -->
    <section id="step1" class="grid grid-cols-1 gap-3 md:grid-cols-2"></section>

    <section id="step2" class="hidden">
      <div class="mb-4 flex items-center justify-between">
        <h2 class="text-lg font-semibold text-slate-100" id="needsTitle">What does this need?</h2>
        <div class="flex gap-2">
          <button id="selectAll" type="button" class="rounded-xl border border-slate-700 bg-slate-800 px-3 py-2 text-xs hover:bg-slate-700">Select all</button>
          <button id="clearAll"  type="button" class="rounded-xl border border-slate-700 bg-slate-800 px-3 py-2 text-xs hover:bg-slate-700">Clear</button>
        </div>
      </div>
      <div id="needsGrid" class="grid grid-cols-1 gap-3 md:grid-cols-2 lg:grid-cols-3"></div>
      <div class="mt-6 flex justify-end gap-2">
        <button id="backTo1" type="button" class="rounded-xl border border-slate-700 bg-slate-800 px-4 py-2 text-sm hover:bg-slate-700">Back</button>
        <button id="toStep3" type="button" class="rounded-xl bg-blue-600 px-4 py-2 text-sm font-semibold text-white hover:bg-blue-700">See solutions</button>
      </div>
    </section>

    <section id="step3" class="hidden">
      <div class="mb-4 flex items-center justify-between">
        <h2 class="text-lg font-semibold text-slate-100">Recommended solutions</h2>
        <button id="adjustNeeds" type="button" class="rounded-xl border border-slate-700 bg-slate-800 px-3 py-2 text-xs hover:bg-slate-700">Adjust needs</button>
      </div>
      <div id="solutionsGrid" class="grid grid-cols-1 gap-4 md:grid-cols-2"></div>
    </section>

    <!-- Modal -->
    <div id="modal" class="fixed inset-0 z-50 hidden items-end md:items-center md:justify-center" role="dialog" aria-modal="true">
      <div class="absolute inset-0 bg-slate-900/70" id="modalBackdrop" tabindex="-1"></div>
      <div class="relative w-full max-w-3xl rounded-t-3xl bg-slate-900 p-6 shadow-2xl ring-1 ring-slate-700 md:rounded-3xl max-h-[85vh] overflow-y-auto modal-scroll">
        <div class="mb-4 flex items-start justify-between gap-4">
          <div>
            <h3 class="text-xl font-bold text-slate-100" id="modalTitle"></h3>
            <p class="text-sm text-slate-400">Comprehensive analysis</p>
          </div>
          <button id="modalClose" type="button" class="rounded-full bg-slate-800 px-3 py-1 text-sm text-slate-100 ring-1 ring-slate-700 hover:bg-slate-700">Close</button>
        </div>

        <div class="mb-4 flex flex-wrap gap-2" id="modalLinks"></div>

        <div class="mb-6 grid grid-cols-1 gap-4 md:grid-cols-2">
          <div class="rounded-2xl border border-green-900 bg-green-900/20 p-4">
            <h4 class="mb-2 text-sm font-semibold text-green-300">Matches your selected needs</h4>
            <ul id="modalMatches" class="list-inside list-disc text-sm text-green-200"></ul>
          </div>
          <div class="rounded-2xl border border-red-900 bg-red-900/20 p-4">
            <h4 class="mb-2 text-sm font-semibold text-red-300">Not covered</h4>
            <ul id="modalMisses" class="list-inside list-disc text-sm text-red-200"></ul>
          </div>
        </div>

        <div id="specialBlocksSection" class="hidden mt-4 rounded-2xl border border-slate-700 bg-slate-800 p-4">
          <ul id="specialBlocksList" class="grid grid-cols-1 gap-2 md:grid-cols-2"></ul>
        </div>

        <div id="terminalDetails" class="hidden mt-4 rounded-2xl border border-slate-700 bg-slate-800 p-4">
          <h4 class="mb-2 text-sm font-semibold text-slate-200">Available SignaPay terminal models</h4>
          <ul class="grid grid-cols-1 gap-2 md:grid-cols-2"></ul>
        </div>

        <div id="shift4Details" class="hidden mt-4 rounded-2xl border border-slate-700 bg-slate-800 p-4">
          <h4 class="mb-2 text-sm font-semibold text-slate-200">Shift4 desktop terminals</h4>
          <ul class="grid grid-cols-1 gap-2 md:grid-cols-2"></ul>
        </div>

        <div class="mt-4" id="allFeaturesBlock">
          <h4 class="mb-2 text-sm font-semibold text-slate-200">All features</h4>
          <div id="allFeatures" class="flex flex-wrap gap-2"></div>
        </div>
      </div>
    </div>

    <!-- Footer -->
    <footer class="mx-auto mt-10 flex items-center justify-between text-xs text-slate-400">
      <div class="opacity-80">Powered by ArtificialSuperIntelligence.AI</div>
      <a href="admin.html"
         class="inline-flex items-center gap-1 rounded-md border border-slate-600/60 bg-slate-800/50 px-3 py-1.5 text-slate-100 hover:bg-slate-700/60 hover:brightness-110 transition">
        Admin
      </a>
    </footer>
  </div>

  <!-- Version-controlled script loader (also stamps JSON fetches) -->
  <script>
  (async () => {
    let v = '';
    try {
      const r = await fetch('./version.txt', { cache: 'no-store' });
      if (r.ok) v = (await r.text()).trim();
    } catch {}

    const prev = localStorage.getItem('app_version') || '';
    localStorage.setItem('app_version', v || '');

    // Always stamp solutions.json requests with version (fresh data)
    const origFetch = window.fetch;
    window.fetch = (input, init) => {
      if (typeof input === 'string' && input.includes('solutions.json') && v) {
        input = input + (input.includes('?') ? '&' : '?') + 'v=' + encodeURIComponent(v);
      }
      return origFetch(input, init);
    };

    // Load app code with version
    const s = document.createElement('script');
    s.type = 'module';
    s.src = 'app.js' + (v ? ('?v=' + encodeURIComponent(v)) : '');
    document.body.appendChild(s);
  })();
  </script>
</body>
</html>
